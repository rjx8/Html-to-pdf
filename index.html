<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Ù…Ø­ÙˆÙ„ HTML Ø¥Ù„Ù‰ PDF</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
    <style>
        body {
            font-family: 'Tahoma', 'Arial', sans-serif;
        }
        
        .code-editor {
            font-family: 'Courier New', monospace;
            direction: ltr;
        }
        
        .preview-frame {
            border: 2px solid #e5e7eb;
            border-radius: 8px;
            background: white;
        }
        
        .print-content {
            display: none;
        }
        
        @media print {
            body * {
                visibility: hidden;
            }
            .print-content, .print-content * {
                visibility: visible;
            }
            .print-content {
                position: absolute;
                left: 0;
                top: 0;
                width: 100%;
                display: block !important;
            }
        }
        
        /* Dark mode support */
        .dark .preview-frame {
            border-color: #374151;
        }
        
        /* iOS specific fixes */
        * {
            -webkit-touch-callout: none;
            -webkit-tap-highlight-color: transparent;
        }
        
        input, textarea, select {
            -webkit-appearance: none;
            border-radius: 6px;
        }
        
        /* Smooth modal transitions */
        #successModal, #errorModal, #confirmModal {
            transition: opacity 0.3s ease-in-out;
            opacity: 0;
        }
        #successModal.flex, #errorModal.flex, #confirmModal.flex {
            opacity: 1;
        }
    </style>
</head>
<body class="bg-gray-50 dark:bg-gray-900 min-h-screen">
    <!-- Dark mode detection -->
    <script>
        if (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) {
            document.documentElement.classList.add('dark');
        }
        window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', event => {
            if (event.matches) {
                document.documentElement.classList.add('dark');
            } else {
                document.documentElement.classList.remove('dark');
            }
        });
    </script>

    <!-- Header -->
    <header class="bg-white dark:bg-gray-800 shadow-sm border-b no-print">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between items-center py-6">
                <div class="flex items-center">
                    <div class="text-3xl ml-3">ğŸ“„</div>
                    <div>
                        <h1 class="text-2xl font-bold text-gray-900 dark:text-white">Ù…Ø­ÙˆÙ„ HTML Ø¥Ù„Ù‰ PDF</h1>
                        <p class="text-sm text-gray-600 dark:text-gray-300">Ø­ÙˆÙ„ Ø£ÙŠ ÙƒÙˆØ¯ HTML Ø¥Ù„Ù‰ Ù…Ù„Ù PDF Ø§Ø­ØªØ±Ø§ÙÙŠ</p>
                    </div>
                </div>
                <div class="flex items-center space-x-reverse space-x-4">
                    <button onclick="loadSample()" class="px-4 py-2 bg-gray-200 dark:bg-gray-700 text-gray-700 dark:text-gray-300 rounded-lg hover:bg-gray-300 dark:hover:bg-gray-600 transition-colors">
                        Ù…Ø«Ø§Ù„ ØªØ¬Ø±ÙŠØ¨ÙŠ
                    </button>
                    <button onclick="clearAll()" class="px-4 py-2 bg-red-500 text-white rounded-lg hover:bg-red-600 transition-colors">
                        Ù…Ø³Ø­ Ø§Ù„ÙƒÙ„
                    </button>
                </div>
            </div>
        </div>
    </header>

    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8 no-print">
        <!-- Settings Panel -->
        <div class="bg-white dark:bg-gray-800 rounded-lg shadow-sm p-6 mb-6">
            <h2 class="text-lg font-semibold text-gray-900 dark:text-white mb-4">âš™ï¸ Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª PDF</h2>
            <div class="grid grid-cols-1 md:grid-cols-4 gap-4">
                <div>
                    <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Ø§Ø³Ù… Ø§Ù„Ù…Ù„Ù</label>
                    <input type="text" id="filename" value="document" placeholder="Ø§Ø³Ù… Ø§Ù„Ù…Ù„Ù" 
                           class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700 text-gray-900 dark:text-white text-base">
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Ø­Ø¬Ù… Ø§Ù„ØµÙØ­Ø©</label>
                    <select id="pageSize" class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700 text-gray-900 dark:text-white text-base">
                        <option value="a4">A4 (210Ã—297mm)</option>
                        <option value="a3">A3 (297Ã—420mm)</option>
                        <option value="letter">Letter (216Ã—279mm)</option>
                        <option value="legal">Legal (216Ã—356mm)</option>
                    </select>
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Ø§ØªØ¬Ø§Ù‡ Ø§Ù„ØµÙØ­Ø©</label>
                    <select id="orientation" class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700 text-gray-900 dark:text-white text-base">
                        <option value="portrait">Ø¹Ù…ÙˆØ¯ÙŠ (Portrait)</option>
                        <option value="landscape">Ø£ÙÙ‚ÙŠ (Landscape)</option>
                    </select>
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Ø§Ù„Ù‡ÙˆØ§Ù…Ø´</label>
                    <select id="margins" class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700 text-gray-900 dark:text-white text-base">
                        <option value="0.5">Ø¶ÙŠÙ‚Ø© (0.5cm)</option>
                        <option value="1.2" selected>Ø¹Ø§Ø¯ÙŠØ© (1.2cm)</option>
                        <option value="1.5">ÙˆØ§Ø³Ø¹Ø© (1.5cm)</option>
                        <option value="2">ÙƒØ¨ÙŠØ±Ø© (2cm)</option>
                    </select>
                </div>
            </div>
        </div>

        <!-- Instructions -->
        <div class="bg-blue-50 dark:bg-blue-900 border border-blue-200 dark:border-blue-700 rounded-lg p-4 mb-6">
            <h2 class="text-lg font-semibold text-blue-800 dark:text-blue-200 mb-2">ğŸ“ Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù…:</h2>
            <ol class="list-decimal list-inside text-blue-700 dark:text-blue-300 space-y-1 text-sm">
                <li>Ø§Ø¶Ø¨Ø· Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª PDF (Ø§Ø³Ù… Ø§Ù„Ù…Ù„ÙØŒ Ø§Ù„Ø­Ø¬Ù…ØŒ Ø§Ù„Ø§ØªØ¬Ø§Ù‡)</li>
                <li>Ø§Ù„ØµÙ‚ ÙƒÙˆØ¯ HTML ÙÙŠ Ø§Ù„Ù…Ø±Ø¨Ø¹</li>
                <li>Ø´Ø§Ù‡Ø¯ Ø§Ù„Ù…Ø¹Ø§ÙŠÙ†Ø© Ø§Ù„Ù…Ø¨Ø§Ø´Ø±Ø©</li>
                <li>Ø§Ø¶ØºØ· "ØªØ­ÙˆÙŠÙ„ Ø¥Ù„Ù‰ PDF" Ù„ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ù„Ù Ù…Ø¨Ø§Ø´Ø±Ø©</li>
            </ol>
        </div>

        <!-- Main Content -->
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
            <!-- HTML Editor -->
            <div class="bg-white dark:bg-gray-800 rounded-lg shadow-sm">
                <div class="flex items-center justify-between p-4 border-b border-gray-200 dark:border-gray-700">
                    <h2 class="text-lg font-semibold text-gray-900 dark:text-white">ÙƒÙˆØ¯ HTML</h2>
                    <div class="flex items-center space-x-reverse space-x-2">
                        <span class="text-sm text-gray-500 dark:text-gray-400" id="charCount">0 Ø­Ø±Ù</span>
                    </div>
                </div>
                <div class="p-4">
                    <textarea 
                        id="htmlInput" 
                        class="w-full h-96 px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700 text-gray-900 dark:text-white code-editor resize-none text-base"
                        placeholder="Ø§Ù„ØµÙ‚ ÙƒÙˆØ¯ HTML Ù‡Ù†Ø§..."
                        oninput="updatePreview(); updateCharCount();"
                    ></textarea>
                </div>
            </div>

            <!-- Preview -->
            <div class="bg-white dark:bg-gray-800 rounded-lg shadow-sm">
                <div class="flex items-center justify-between p-4 border-b border-gray-200 dark:border-gray-700">
                    <h2 class="text-lg font-semibold text-gray-900 dark:text-white">Ù…Ø¹Ø§ÙŠÙ†Ø© Ù…Ø¨Ø§Ø´Ø±Ø©</h2>
                    <button onclick="convertToPDF()" 
                            class="flex items-center px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors disabled:bg-gray-400 disabled:cursor-not-allowed" 
                            id="convertBtn">
                        <span id="convertText">ØªØ­ÙˆÙŠÙ„ Ø¥Ù„Ù‰ PDF</span>
                        <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 10v6m0 0l-4-4m4 4l4-4m5-3a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                        </svg>
                    </button>
                </div>
                <div class="p-4">
                    <div id="preview" class="preview-frame h-96 overflow-auto bg-white dark:bg-gray-800 p-4">
                        <p style="text-align:center;color:#666;padding:50px;">Ø³ØªØ¸Ù‡Ø± Ø§Ù„Ù…Ø¹Ø§ÙŠÙ†Ø© Ù‡Ù†Ø§...</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Features -->
        <div class="mt-12 grid grid-cols-1 md:grid-cols-3 gap-6">
            <div class="bg-white dark:bg-gray-800 p-6 rounded-lg shadow-sm text-center">
                <div class="text-4xl mb-4">âš¡</div>
                <h3 class="text-lg font-semibold text-gray-900 dark:text-white mb-2">ØªØ­ÙˆÙŠÙ„ Ø³Ø±ÙŠØ¹</h3>
                <p class="text-gray-600 dark:text-gray-300 text-sm">ØªØ­ÙˆÙŠÙ„ ÙÙˆØ±ÙŠ Ù…Ù† HTML Ø¥Ù„Ù‰ PDF Ø¨Ø¬ÙˆØ¯Ø© Ø¹Ø§Ù„ÙŠØ©</p>
            </div>
            <div class="bg-white dark:bg-gray-800 p-6 rounded-lg shadow-sm text-center">
                <div class="text-4xl mb-4">ğŸ¨</div>
                <h3 class="text-lg font-semibold text-gray-900 dark:text-white mb-2">Ø¯Ø¹Ù… ÙƒØ§Ù…Ù„ Ù„Ù„ØªØµÙ…ÙŠÙ…</h3>
                <p class="text-gray-600 dark:text-gray-300 text-sm">ÙŠØ­Ø§ÙØ¸ Ø¹Ù„Ù‰ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø£Ù„ÙˆØ§Ù† ÙˆØ§Ù„Ø®Ø·ÙˆØ· ÙˆØ§Ù„ØªÙ†Ø³ÙŠÙ‚Ø§Øª</p>
            </div>
            <div class="bg-white dark:bg-gray-800 p-6 rounded-lg shadow-sm text-center">
                <div class="text-4xl mb-4">ğŸ“±</div>
                <h3 class="text-lg font-semibold text-gray-900 dark:text-white mb-2">Ù…ØªÙˆØ§ÙÙ‚ Ù…Ø¹ Ø§Ù„Ø¬ÙˆØ§Ù„</h3>
                <p class="text-gray-600 dark:text-gray-300 text-sm">ÙŠØ¹Ù…Ù„ Ø¨Ø³Ù„Ø§Ø³Ø© Ø¹Ù„Ù‰ iPhone Ùˆ iPad</p>
            </div>
        </div>
    </div>

    <!-- Hidden content for PDF conversion -->
    <div id="pdfContent" class="print-content">
        <!-- Content will be inserted here -->
    </div>

    <!-- Success Modal -->
    <div id="successModal" class="fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center z-50">
        <div class="bg-white dark:bg-gray-800 p-6 rounded-lg shadow-lg max-w-sm w-full mx-4">
            <div class="text-center">
                <div class="text-6xl mb-4">âœ…</div>
                <h3 class="text-lg font-semibold text-gray-900 dark:text-white mb-2">ØªÙ… Ø§Ù„ØªØ­ÙˆÙŠÙ„ Ø¨Ù†Ø¬Ø§Ø­!</h3>
                <p class="text-gray-600 dark:text-gray-300 mb-4">ØªÙ… ØªØ­Ù…ÙŠÙ„ Ù…Ù„Ù PDF Ø¨Ù†Ø¬Ø§Ø­</p>
                <button onclick="closeSuccessModal()" class="px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors">
                    Ø­Ø³Ù†Ø§Ù‹
                </button>
            </div>
        </div>
    </div>

    <!-- Error Modal -->
    <div id="errorModal" class="fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center z-50">
        <div class="bg-white dark:bg-gray-800 p-6 rounded-lg shadow-lg max-w-sm w-full mx-4">
            <div class="text-center">
                <div class="text-6xl mb-4">âŒ</div>
                <h3 class="text-lg font-semibold text-gray-900 dark:text-white mb-2">Ø®Ø·Ø£ ÙÙŠ Ø§Ù„ØªØ­ÙˆÙŠÙ„</h3>
                <p class="text-gray-600 dark:text-gray-300 mb-4" id="errorMessage">Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ ØªØ­ÙˆÙŠÙ„ Ø§Ù„Ù…Ù„Ù</p>
                <button onclick="closeErrorModal()" class="px-4 py-2 bg-red-500 text-white rounded-lg hover:bg-red-600 transition-colors">
                    Ø¥ØºÙ„Ø§Ù‚
                </button>
            </div>
        </div>
    </div>

    <!-- Confirm Modal -->
    <div id="confirmModal" class="fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center z-50">
        <div class="bg-white dark:bg-gray-800 p-6 rounded-lg shadow-lg max-w-sm w-full mx-4">
            <div class="text-center">
                <div class="text-6xl mb-4">âš ï¸</div>
                <h3 class="text-lg font-semibold text-gray-900 dark:text-white mb-2">ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø¹Ù…Ù„ÙŠØ©</h3>
                <p class="text-gray-600 dark:text-gray-300 mb-4" id="confirmMessage">Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ù…Ø³Ø­ Ø§Ù„ÙƒÙˆØ¯ Ø¨Ø§Ù„ÙƒØ§Ù…Ù„ØŸ</p>
                <div class="flex justify-center space-x-reverse space-x-3">
                    <button onclick="closeConfirmModal()" class="px-4 py-2 text-gray-600 dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg transition-colors">
                        Ø¥Ù„ØºØ§Ø¡
                    </button>
                    <button onclick="confirmClear()" class="px-4 py-2 bg-red-500 text-white hover:bg-red-600 rounded-lg transition-colors">
                        ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ù…Ø³Ø­
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Update character count
        function updateCharCount() {
            const input = document.getElementById('htmlInput');
            const count = input.value.length;
            document.getElementById('charCount').textContent = `${count.toLocaleString()} Ø­Ø±Ù`;
        }

        // Update preview - Ø­Ù…Ø§ÙŠØ© Ù…Ù† Ø§Ù„Ø£ÙƒÙˆØ§Ø¯ Ø§Ù„Ø®Ø¨ÙŠØ«Ø©
        function updatePreview() {
            const htmlContent = document.getElementById('htmlInput').value;
            const sanitizedHTML = htmlContent.replace(/<script[\s\S]*?>[\s\S]*?<\/script>/gi, '');
            const preview = document.getElementById('preview');
            preview.innerHTML = sanitizedHTML || '<p style="text-align:center;color:#666;padding:50px;">Ø³ØªØ¸Ù‡Ø± Ø§Ù„Ù…Ø¹Ø§ÙŠÙ†Ø© Ù‡Ù†Ø§...</p>';
        }

        // Load sample HTML
        function loadSample() {
            const sampleHTML = `<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <title>Ù…Ø«Ø§Ù„ ØªØ¬Ø±ÙŠØ¨ÙŠ</title>
    <style>
        body { 
            font-family: 'Tahoma', Arial; 
            padding: 20px; 
            max-width: 800px; 
            margin: 0 auto;
            line-height: 1.6;
        }
        .header { 
            background: #5D5CDE; 
            color: white; 
            padding: 20px; 
            border-radius: 8px; 
            text-align: center; 
            margin-bottom: 20px;
        }
        .content { 
            margin: 20px 0; 
            padding: 20px; 
            border: 1px solid #ddd; 
            border-radius: 8px; 
            background: #f9f9f9;
        }
        .footer { 
            text-align: center; 
            color: #666; 
            margin-top: 20px; 
            border-top: 1px solid #ddd;
            padding-top: 20px;
        }
        ul { 
            background: white; 
            padding: 15px; 
            border-radius: 5px;
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>Ù…Ø±Ø­Ø¨Ø§Ù‹ Ø¨Ùƒ ÙÙŠ Ù…Ø­ÙˆÙ„ HTML Ø¥Ù„Ù‰ PDF</h1>
        <p>Ø£Ø¯Ø§Ø© Ù…Ø¬Ø§Ù†ÙŠØ© ÙˆØ³Ù‡Ù„Ø© Ø§Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù…</p>
    </div>
    
    <div class="content">
        <h2>ğŸŒŸ Ù…Ù…ÙŠØ²Ø§Øª Ø§Ù„Ù…Ø­ÙˆÙ„</h2>
        <p>ÙŠÙ…ÙƒÙ†Ùƒ ØªØ¹Ø¯ÙŠÙ„ Ù‡Ø°Ø§ Ø§Ù„ÙƒÙˆØ¯ Ø£Ùˆ Ø§Ø³ØªØ¨Ø¯Ø§Ù„Ù‡ Ø¨ÙƒÙˆØ¯Ùƒ Ø§Ù„Ø®Ø§Øµ. Ù‡Ø°Ø§ Ø§Ù„Ù…Ø­ÙˆÙ„ ÙŠØ¯Ø¹Ù…:</p>
        <ul>
            <li>Ø¯Ø¹Ù… ÙƒØ§Ù…Ù„ Ù„Ù„Ù†ØµÙˆØµ Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©</li>
            <li>ØªØµÙ…ÙŠÙ… Ø§Ø­ØªØ±Ø§ÙÙŠ ÙˆØ£Ù†ÙŠÙ‚</li>
            <li>Ø¬ÙˆØ¯Ø© Ø¹Ø§Ù„ÙŠØ© Ù„Ù„Ø·Ø¨Ø§Ø¹Ø©</li>
            <li>Ø³Ù‡ÙˆÙ„Ø© ÙÙŠ Ø§Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù…</li>
            <li>Ù…ØªÙˆØ§ÙÙ‚ Ù…Ø¹ iPhone Ùˆ iPad</li>
        </ul>
        
        <h3>ğŸ“‹ Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù…:</h3>
        <p>1. Ø¶Ø¹ ÙƒÙˆØ¯ HTML ÙÙŠ Ø§Ù„Ù…Ø±Ø¨Ø¹ Ø§Ù„Ø£ÙŠØ³Ø±</p>
        <p>2. Ø´Ø§Ù‡Ø¯ Ø§Ù„Ù…Ø¹Ø§ÙŠÙ†Ø© ÙÙŠ Ø§Ù„Ù…Ø±Ø¨Ø¹ Ø§Ù„Ø£ÙŠÙ…Ù†</p>
        <p>3. Ø§Ø¶ØºØ· Ø²Ø± "ØªØ­ÙˆÙŠÙ„ Ø¥Ù„Ù‰ PDF"</p>
        <p>4. Ø³ÙŠØªÙ… ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ù„Ù ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹</p>
    </div>
    
    <div class="footer">
        <p><strong>ØªÙ… Ø¥Ù†Ø´Ø§Ø¤Ù‡ Ø¨ÙˆØ§Ø³Ø·Ø© Ù…Ø­ÙˆÙ„ HTML Ø¥Ù„Ù‰ PDF</strong></p>
        <p>Ù…ØªÙˆØ§ÙÙ‚ Ù…Ø¹ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø£Ø¬Ù‡Ø²Ø© - 2024</p>
    </div>
</body>
</html>`;
            
            document.getElementById('htmlInput').value = sampleHTML;
            updatePreview();
            updateCharCount();
        }

        // Clear all content with confirmation
        function clearAll() {
            const modal = document.getElementById('confirmModal');
            modal.classList.remove('hidden');
            modal.classList.add('flex');
        }

        // Confirm clear action
        function confirmClear() {
            document.getElementById('htmlInput').value = '';
            updatePreview();
            updateCharCount();
            closeConfirmModal();
        }

        // Close confirm modal
        function closeConfirmModal() {
            document.getElementById('confirmModal').classList.add('hidden');
            document.getElementById('confirmModal').classList.remove('flex');
        }

        // Convert to PDF - Ù†Ø³Ø®Ø© 10/10 Ù…Ø¹ Ø¬Ù…ÙŠØ¹ Ø§Ù„ØªØ­Ø³ÙŠÙ†Ø§Øª
        async function convertToPDF() {
            const htmlContent = document.getElementById('htmlInput').value.trim();
            
            if (!htmlContent) {
                showError('Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø¥Ø¯Ø®Ø§Ù„ ÙƒÙˆØ¯ HTML Ø£ÙˆÙ„Ø§Ù‹');
                return;
            }

            try {
                // Get user settings with auto filename generation
                const userFilename = document.getElementById('filename').value;
                const filename = userFilename || `PDF_${new Date().toISOString().slice(0,19).replace(/[:T]/g, '-')}`;
                const pageSize = document.getElementById('pageSize').value;
                const orientation = document.getElementById('orientation').value;
                const margins = parseFloat(document.getElementById('margins').value);
                
                // Update button state
                const btn = document.getElementById('convertBtn');
                const btnText = document.getElementById('convertText');
                
                btn.disabled = true;
                btnText.textContent = 'Ø¬Ø§Ø±Ù Ø§Ù„ØªØ­ÙˆÙŠÙ„...';
                
                // Create a temporary container for proper rendering
                const tempContainer = document.createElement('div');
                tempContainer.style.cssText = `
                    opacity: 0;
                    position: absolute;
                    left: -9999px;
                    top: 0;
                    width: 210mm;
                    min-height: 297mm;
                    background: white;
                    font-family: Arial, 'Tahoma', sans-serif;
                    direction: rtl;
                    padding: 20px;
                    box-sizing: border-box;
                    z-index: -1;
                `;
                
                // Add enhanced CSS for better PDF rendering
                const styledContent = `
                    <style>
                        * {
                            box-sizing: border-box;
                        }
                        body {
                            font-family: Arial, 'Tahoma', sans-serif !important;
                            line-height: 1.6;
                            color: #333;
                            direction: rtl;
                            background: white !important;
                            margin: 0;
                            padding: 0;
                            width: 100%;
                        }
                        img {
                            max-width: 100% !important;
                            height: auto !important;
                            display: block;
                            page-break-inside: avoid;
                        }
                        table {
                            width: 100%;
                            border-collapse: collapse;
                            page-break-inside: avoid;
                        }
                        h1, h2, h3, h4, h5, h6 {
                            page-break-after: avoid;
                            page-break-inside: avoid;
                            margin-bottom: 10px;
                        }
                        p {
                            margin-bottom: 10px;
                            page-break-inside: avoid;
                        }
                        div {
                            page-break-inside: avoid;
                        }
                        .page-break {
                            page-break-before: always;
                        }
                        /* ØªØ¬Ù†Ø¨ Ø§Ù„ÙƒØ³Ø± ÙÙŠ Ø§Ù„Ø¹Ù†Ø§ØµØ± Ø§Ù„Ù…Ù‡Ù…Ø© */
                        .no-break {
                            page-break-inside: avoid;
                        }
                    </style>
                    ${htmlContent}
                `;
                
                tempContainer.innerHTML = styledContent;
                document.body.appendChild(tempContainer);
                
                // Wait for fonts and images to load properly
                await document.fonts.ready;
                await Promise.all(Array.from(tempContainer.querySelectorAll('img')).map(img => {
                    if (!img.complete) {
                        return new Promise(resolve => { 
                            img.onload = img.onerror = resolve; 
                        });
                    }
                    return Promise.resolve();
                }));

                // Additional wait for proper rendering
                await new Promise(resolve => setTimeout(resolve, 1500));
                
                // Configure html2pdf options with enhanced settings
                const opt = {
                    margin: [margins, margins, margins, margins],
                    filename: `${filename}.pdf`,
                    image: { 
                        type: 'jpeg', 
                        quality: 1.0 
                    },
                    html2canvas: { 
                        scale: 2,
                        useCORS: true,
                        allowTaint: false,
                        scrollX: 0,
                        scrollY: 0,
                        backgroundColor: '#ffffff',
                        width: tempContainer.scrollWidth || 794, // A4 width in pixels at 96 DPI
                        height: tempContainer.scrollHeight || 1123, // A4 height in pixels at 96 DPI
                        windowWidth: 794,
                        windowHeight: 1123,
                        dpi: 300,
                        letterRendering: true
                    },
                    jsPDF: { 
                        unit: 'cm', 
                        format: pageSize, 
                        orientation: orientation,
                        compress: true,
                        putOnlyUsedFonts: true
                    },
                    pagebreak: { 
                        mode: ['avoid-all', 'css', 'legacy'] 
                    }
                };

                // Try primary conversion method
                try {
                    await html2pdf().from(tempContainer).set(opt).save();
                    
                    // Success - clean up and show message
                    document.body.removeChild(tempContainer);
                    btn.disabled = false;
                    btnText.textContent = 'ØªØ­ÙˆÙŠÙ„ Ø¥Ù„Ù‰ PDF';
                    showSuccess();
                    
                } catch (saveError) {
                    console.warn('Primary save method failed, trying fallback...', saveError);
                    
                    // Fallback method for Safari/iOS
                    const pdf = await html2pdf().from(tempContainer).set(opt).outputPdf('blob');
                    const blobUrl = URL.createObjectURL(pdf);
                    const link = document.createElement('a');
                    link.href = blobUrl;
                    link.download = `${filename}.pdf`;
                    link.style.display = 'none';
                    document.body.appendChild(link);
                    link.click();
                    document.body.removeChild(link);
                    URL.revokeObjectURL(blobUrl);
                    
                    // Clean up and show success
                    document.body.removeChild(tempContainer);
                    btn.disabled = false;
                    btnText.textContent = 'ØªØ­ÙˆÙŠÙ„ Ø¥Ù„Ù‰ PDF';
                    showSuccess();
                }

            } catch (error) {
                console.error('PDF conversion error:', error);
                
                // Clean up on error
                const tempContainer = document.querySelector('div[style*="position: fixed"][style*="top: -10000px"]');
                if (tempContainer && document.body.contains(tempContainer)) {
                    document.body.removeChild(tempContainer);
                }
                
                const btn = document.getElementById('convertBtn');
                const btnText = document.getElementById('convertText');
                btn.disabled = false;
                btnText.textContent = 'ØªØ­ÙˆÙŠÙ„ Ø¥Ù„Ù‰ PDF';
                showError('Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ ØªØ­ÙˆÙŠÙ„ Ø§Ù„Ù…Ù„Ù Ø¥Ù„Ù‰ PDF. ØªØ£ÙƒØ¯ Ù…Ù† ØµØ­Ø© ÙƒÙˆØ¯ HTML.');
            }
        }

        // Show success modal
        function showSuccess() {
            const modal = document.getElementById('successModal');
            modal.classList.remove('hidden');
            modal.classList.add('flex');
        }

        // Close success modal
        function closeSuccessModal() {
            document.getElementById('successModal').classList.add('hidden');
            document.getElementById('successModal').classList.remove('flex');
        }

        // Show error modal
        function showError(message) {
            document.getElementById('errorMessage').textContent = message;
            document.getElementById('errorModal').classList.remove('hidden');
            document.getElementById('errorModal').classList.add('flex');
        }

        // Close error modal
        function closeErrorModal() {
            document.getElementById('errorModal').classList.add('hidden');
            document.getElementById('errorModal').classList.remove('flex');
        }

        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            updateCharCount();
            updatePreview();
        });
    </script>
</body>
</html>